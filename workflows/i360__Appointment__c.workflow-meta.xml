<?xml version="1.0" encoding="UTF-8"?>
<Workflow xmlns="http://soap.sforce.com/2006/04/metadata">
    <alerts>
        <fullName>i360__Appointment_Cancelation</fullName>
        <description>Appointment Cancelation</description>
        <protected>false</protected>
        <recipients>
            <field>i360__Email_Address__c</field>
            <type>email</type>
        </recipients>
        <senderType>CurrentUser</senderType>
        <template>i360__Lifecycle_Communications/i360__Appointment_Cancelation_Notice</template>
    </alerts>
    <alerts>
        <fullName>i360__Appointment_Confirmation</fullName>
        <description>Appointment Confirmation</description>
        <protected>false</protected>
        <recipients>
            <field>i360__Email_Address__c</field>
            <type>email</type>
        </recipients>
        <senderType>CurrentUser</senderType>
        <template>i360__Lifecycle_Communications/i360__Appointment_Confirmation_Email</template>
    </alerts>
    <alerts>
        <fullName>i360__Send_Thank_You_Email</fullName>
        <description>Send Thank You Email</description>
        <protected>false</protected>
        <recipients>
            <field>i360__Email_Address__c</field>
            <type>email</type>
        </recipients>
        <senderType>CurrentUser</senderType>
        <template>i360__Templates_Appointment/i360__Thank_You_Email</template>
    </alerts>
    <fieldUpdates>
        <fullName>Update_SR1_Email</fullName>
        <field>Sales_Rep_1_Email__c</field>
        <formula>i360__Sales_Rep_1__r.i360__Email__c</formula>
        <name>Update SR1 Email</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Updated_resulted_On_Date_Time</fullName>
        <field>Resulted_Date_Time__c</field>
        <formula>NOW()</formula>
        <name>Updated resulted On Date/Time</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>i360__Sync_Appointment_Email</fullName>
        <description>Keeps the appointment &apos;Email Address&apos; field synced up with the prospect&apos;s.  This is done so that our workflow rules can use the prospect email, since they cannot directly read it.</description>
        <field>i360__Email_Address__c</field>
        <formula>IF(ISNULL(i360__Prospect__r.i360__Primary_Email__c) || i360__Prospect__r.i360__Primary_Email__c = &apos;&apos;, i360__Prospect__r.i360__Secondary_Email__c, i360__Prospect__r.i360__Primary_Email__c)</formula>
        <name>Sync Appointment Email</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>i360__Thank_you_email_Sent_Date</fullName>
        <field>i360__Thank_you_Email_Sent_Date__c</field>
        <formula>TODAY()</formula>
        <name>Thank you email Sent Date</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <rules>
        <fullName>Update Appointment Resulted On Date</fullName>
        <actions>
            <name>Updated_resulted_On_Date_Time</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>NOT(ISBLANK(TEXT(i360__Result__c)))</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Update SR1 Email</fullName>
        <actions>
            <name>Update_SR1_Email</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Updated the Email to the correct value for the current sales rep!</description>
        <formula>ISBLANK( i360__Sales_Rep_1__c )
||
ISCHANGED( i360__Sales_Rep_1__c )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>i360__Appointment Cancelation</fullName>
        <actions>
            <name>i360__Sync_Appointment_Email</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <criteriaItems>
            <field>i360__Appointment__c.i360__Email_Address__c</field>
            <operation>notEqual</operation>
        </criteriaItems>
        <criteriaItems>
            <field>i360__Appointment__c.i360__Send_Email_On_Cancelation__c</field>
            <operation>equals</operation>
            <value>True</value>
        </criteriaItems>
        <criteriaItems>
            <field>i360__Appointment__c.i360__Prospect_Opt_Out_Email__c</field>
            <operation>equals</operation>
            <value>False</value>
        </criteriaItems>
        <description>Sends out an email to the prospect in response to a canceled appointment.</description>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>i360__Appointment Confirmation</fullName>
        <actions>
            <name>i360__Sync_Appointment_Email</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <criteriaItems>
            <field>i360__Appointment__c.i360__Email_Address__c</field>
            <operation>notEqual</operation>
        </criteriaItems>
        <criteriaItems>
            <field>i360__Appointment__c.i360__Send_Email_On_Setup__c</field>
            <operation>equals</operation>
            <value>True</value>
        </criteriaItems>
        <criteriaItems>
            <field>i360__Appointment__c.i360__Prospect_Opt_Out_Email__c</field>
            <operation>equals</operation>
            <value>False</value>
        </criteriaItems>
        <description>Sends out an email to the prospect with information about their upcoming appointment.</description>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>i360__Send Thank you Email</fullName>
        <actions>
            <name>i360__Send_Thank_You_Email</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>i360__Thank_you_email_Sent_Date</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>i360__Thank_you_Email_Sent</name>
            <type>Task</type>
        </actions>
        <active>true</active>
        <description>Send a thank you after an appointment is resulted as Demoed, Not Sold.</description>
        <formula>NOT(ISBLANK( i360__Prospect__r.i360__Primary_Email__c )) &amp;&amp;  NOT( i360__Prospect__r.i360__Opt_Out_Email__c) &amp;&amp;   i360__Send_Thank_You_Email__c &amp;&amp; ISBLANK( i360__Thank_you_Email_Sent_Date__c ) &amp;&amp;  (ISPICKVAL( i360__Result__c, &quot;Demoed, Not Sold&quot;))</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <tasks>
        <fullName>i360__Thank_you_Email_Sent</fullName>
        <assignedToType>owner</assignedToType>
        <dueDateOffset>0</dueDateOffset>
        <notifyAssignee>false</notifyAssignee>
        <offsetFromField>i360__Appointment__c.CreatedDate</offsetFromField>
        <priority>Normal</priority>
        <protected>false</protected>
        <status>Completed</status>
        <subject>Thank you Email Sent</subject>
    </tasks>
</Workflow>
